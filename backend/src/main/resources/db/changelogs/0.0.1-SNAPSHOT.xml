<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="000001" author="viannagustavo71@gmail.com">
        <sql>
            CREATE TYPE order_status AS ENUM ('OPEN', 'FINALIZED', 'CANCELED', 'PAID');
            CREATE TYPE user_type AS ENUM ('ADMIN', 'MANAGER', 'EMPLOYEE', 'CUSTOMER');
            CREATE TYPE payment_method AS ENUM ('CASH', 'PIX', 'CARD');
        </sql>

        <comment>
            Cria tipos para serem usados junto com enums
        </comment>
    </changeSet>

    <changeSet id="000002" author="viannagustavo71@gmail.com">
        <sql>
            CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
        </sql>

        <comment>
            Adiciona extensão para gerar UUID's
        </comment>
    </changeSet>

    <changeSet id="000003" author="viannagustavo71@gmail.com">
        <sql>
            CREATE TABLE IF NOT EXISTS products (
                id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
                stock INT DEFAULT 0,
                price DECIMAL(7, 2) NOT NULL,
                cost DECIMAL(7,2) NOT NULL,
                created_at TIMESTAMP DEFAULT NOW(),
                updated_at TIMESTAMP DEFAULT NOW(),
                name VARCHAR(100) NOT NULL,
                description TEXT,
                image_url TEXT
            );
        </sql>

        <comment>
            Cria a tabela de produtos
        </comment>
    </changeSet>

    <changeSet id="000004" author="viannagustavo71@gmail.com">
        <sql>
            CREATE TABLE IF NOT EXISTS orders (
                id BIGSERIAL PRIMARY KEY,
                created_at TIMESTAMP DEFAULT NOW(),
                date_finished TIMESTAMP,
                date_cancelled TIMESTAMP,
                customer_id BIGINT NOT NULL,
                status order_status NOT NULL DEFAULT 'OPEN'
            );
        </sql>

        <comment>
            Cria a tabela de pedidos
        </comment>
    </changeSet>

    <changeSet id="000005" author="viannagustavo71@gmail.com">
        <sql>
            CREATE TABLE IF NOT EXISTS order_items (
                order_id BIGINT NOT NULL,
                product_id BIGINT NOT NULL,
                quantity INT NOT NULL DEFAULT 1,
                PRIMARY KEY (order_id, product_id),
                FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
                FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE
            );
        </sql>

        <comment>
            Cria a tabela de relação entre pedidos e produtos
        </comment>
    </changeSet>

    <changeSet id="000006" author="viannagustavo71@gmail.com">
        <sql>
            CREATE TABLE IF NOT EXISTS payments (
                id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
                order_id BIGINT NOT NULL,
                payment_date TIMESTAMP DEFAULT NOW(),
                amount DECIMAL(7, 2) NOT NULL,
                method payment_method NOT NULL,
                FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE
            );
        </sql>

        <comment>
            Cria a tabela de pagamentos
        </comment>
    </changeSet>

</databaseChangeLog>
